function [Aconnect,Jacobi,H]=Kepoxs(s,i,j,k,px,py,th,flag)

if flag==1


H=[0.555555556 0.88888889 0.555555556];
W=[0.7745966692
   0.0000000000
  -0.7745966692];


    
    

        e=W(i);
        n=W(j);
        J=W(k);        
    z=0.5*th*J;
else
   
    e=i;
    n=j;

    z=k;
end
        

        X1 = px(1,s); X2 = px(2,s);
        X3 = px(3,s); X4 = px(4,s); 

        Y1 = py(1,s); Y2 = py(2,s);
        Y3 = py(3,s); Y4 = py(4,s); 



J11 = -(n+1)*X4/4.0+(n+1)*X3/4.0+(1-n)*X2/4.0-(1-n)*X1/4.0;
J12 = -(n+1)*Y4/4.0+(n+1)*Y3/4.0+(1-n)*Y2/4.0-(1-n)*Y1/4.0;
J21 = +(1-e)*X4/4.0+(e+1)*X3/4.0-(e+1)*X2/4.0-(1-e)*X1/4.0;
J22 = +(1-e)*Y4/4.0+(e+1)*Y3/4.0-(e+1)*Y2/4.0-(1-e)*Y1/4.0;


 Jacobi=[ J11    J12 
          J21    J22];
         

          InvJ=Jacobi^-1;

          g11=InvJ(1,1);   g12=InvJ(1,2); 
          g21=InvJ(2,1);   g22=InvJ(2,2);
        


Hx = [ -g11*(1-n)/4.0-(1-e)*g12/4.0
        g11*(1-n)/4.0-(e+1)*g12/4.0
        g11*(n+1)/4.0+(e+1)*g12/4.0
        (1-e)*g12/4.0-g11*(n+1)/4.0];

Hy = [ -g21*(1-n)/4.0-(1-e)*g22/4.0
        g21*(1-n)/4.0-(e+1)*g22/4.0
        g21*(n+1)/4.0+(e+1)*g22/4.0
        (1-e)*g22/4.0-g21*(n+1)/4.0];



N = [1/4*(1-e)*(1-n)
     1/4*(1+e)*(1-n)
     1/4*(1+e)*(1+n)
     1/4*(1-e)*(1+n)];


for f=1:4;
Aconnect(:,5*(f-1)+1,s)= [Hx(f)  ;   0    ; Hy(f)  ;  0  ;  0   ];
Aconnect(:,5*(f-1)+2,s)= [  0    ;Hy(f)   ; Hx(f)  ;  0  ;  0   ];
Aconnect(:,5*(f-1)+3,s)= [  0    ;   0    ;   0    ;Hy(f); Hx(f)];
Aconnect(:,5*(f-1)+4,s)= [  0    ;-z*Hy(f);-z*Hx(f);-N(f);  0   ];
Aconnect(:,5*(f-1)+5,s)= [z*Hx(f);   0    ; z*Hy(f);  0  ; N(f) ];
end
   
